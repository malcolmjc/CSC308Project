!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("excalibur")):"function"==typeof define&&define.amd?define(["excalibur"],e):"object"==typeof exports?exports["Extensions.Tiled"]=e(require("excalibur")):t["Extensions.Tiled"]=e(t.ex)}(this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var o,i=r(1);!function(t){t[t.TMX=0]="TMX",t[t.JSON=1]="JSON"}(o=e.TiledMapFormat||(e.TiledMapFormat={}));var a=function(t){function e(e,r){void 0===r&&(r=o.JSON);var n=this;switch(r){case o.JSON:n=t.call(this,e,"json")||this;break;default:throw"The format "+r+" is not currently supported. Please export Tiled map as JSON."}return n.mapFormat=r,n.imagePathAccessor=n.externalTilesetPathAccessor=function(t,r){if(0===t.indexOf("/"))return t;var n=e.split("/"),o=n.concat([]);return n.length>0&&o.splice(-1),o.push(t),o.join("/")},n}return n(e,t),e.prototype.load=function(){var e=this,r=new i.Promise;return t.prototype.load.call(this).then(function(t){var n=[];e.data.tilesets.forEach(function(t){if(t.source){var r=new i.Resource(e.externalTilesetPathAccessor(t.source,t),"json");n.push(r.load().then(function(e){Object.assign(t,e)}))}}),i.Promise.join.apply(e,n).then(function(){n=[],e.data.tilesets.forEach(function(t){var r=new i.Texture(e.imagePathAccessor(t.image,t));t.imageTexture=r,n.push(r.load()),i.Logger.getInstance().debug("[Tiled] Loading associated tileset: "+t.image)}),i.Promise.join.apply(e,n).then(function(){r.resolve(t)},function(t){r.reject(t)})},function(t){r.reject(t)})}),r},e.prototype.processData=function(t){if("object"!=typeof t)throw"Tiled map resource "+this.path+" is not the correct content type";if(void 0===t)throw"Tiled map resource "+this.path+" is empty";switch(this.mapFormat){case o.JSON:return s(t)}},e.prototype.getTilesetForTile=function(t){for(var e=this.data.tilesets.length-1;e>=0;e--){var r=this.data.tilesets[e];if(r.firstgid<=t)return r}return null},e.prototype.getTileMap=function(){for(var t=new i.TileMap(0,0,this.data.tilewidth,this.data.tileheight,this.data.height,this.data.width),e=0,r=this.data.tilesets;e<r.length;e++){var n=r[e],o=Math.floor(n.imagewidth/n.tilewidth),a=Math.floor(n.imageheight/n.tileheight),s=new i.SpriteSheet(n.imageTexture,o,a,n.tilewidth,n.tileheight);t.registerSpriteSheet(n.firstgid.toString(),s)}for(var c=0,u=this.data.layers;c<u.length;c++){var h=u[c];if("tilelayer"===h.type)for(var l=0;l<h.data.length;l++){var f=h.data[l];if(0!==f){var n=this.getTilesetForTile(f);t.data[l].sprites.push(new i.TileSprite(n.firstgid.toString(),f-n.firstgid))}}}return t},e}(i.Resource);e.default=a;var s=function(t){if(t.layers)for(var e=0,r=t.layers;e<r.length;e++){var n=r[e];"string"==typeof n.data?"base64"===n.encoding&&(n.data=c.decompressBase64(n.data,n.encoding)):n.data=c.decompressCsv(n.data)}return t},c={decompressCsv:function(t){return t},decompressBase64:function(t,e){function r(t){var e=t.charCodeAt(0);return e===l||e===v?62:e===f||e===y?63:e<d?-1:e<d+10?e-d+26+26:e<g+26?e-g:e<p+26?e-p+26:void 0}function n(t){u[A++]=t}var o,i,a,s,c,u;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h="undefined"!=typeof Uint8Array?Uint8Array:Array,l="+".charCodeAt(0),f="/".charCodeAt(0),d="0".charCodeAt(0),p="a".charCodeAt(0),g="A".charCodeAt(0),v="-".charCodeAt(0),y="_".charCodeAt(0),m=t.length;c="="===t.charAt(m-2)?2:"="===t.charAt(m-1)?1:0,u=new h(3*t.length/4-c),a=c>0?t.length-4:t.length;var A=0;for(o=0,i=0;o<a;o+=4,i+=3)s=r(t.charAt(o))<<18|r(t.charAt(o+1))<<12|r(t.charAt(o+2))<<6|r(t.charAt(o+3)),n((16711680&s)>>16),n((65280&s)>>8),n(255&s);2===c?(s=r(t.charAt(o))<<2|r(t.charAt(o+1))>>4,n(255&s)):1===c&&(s=r(t.charAt(o))<<10|r(t.charAt(o+1))<<4|r(t.charAt(o+2))>>2,n(s>>8&255),n(255&s));var x=u.length/4,w=new Array(x);for(o=0;o<x;o++)w[o]=function(t){for(var e=0,r=t.length-1;r>=0;r--)e=256*e+1*t[r];return e}(u.slice(4*o,4*o+3));return w}}},function(e,r){e.exports=t}])});
//# sourceMappingURL=excalibur-tiled.min.js.map