import { DeltaContainer, DataChange } from "./src";

function clone (data: any) {
    return JSON.parse(JSON.stringify(data));
}

let container = new DeltaContainer({});
container.listen("buildables/:id", (change: DataChange) => {});
container.listen("state", (change: DataChange) => {});
container.listen("info/buildables/:string", (change: DataChange) => {});
container.listen("items/:id", (change: DataChange) => {});
container.listen("timers/:id", (change: DataChange) => {
    console.log("timers/:id", change);
});
container.listen("timers/:id/:attribute", (change: DataChange) => {
    console.log("timers/:id/:attribute", change);
});
container.listen("buildables/:id/operations/:op", (change: DataChange) => {
    console.log(change);
});

let data: any = {
    "state": 0,
    "timers": {
        "game": {
            "cnt": -1,
            "max": 900,
            "running": false,
            "paused": false
        },
        "reconnect": {
            "cnt": -1,
            "max": 0,
            "running": false,
            "paused": false
        },
        "countdown": {
            "cnt": -1,
            "max": 0,
            "running": false,
            "paused": false
        },
        "unpause": {
            "cnt": -1,
            "max": 0,
            "running": false,
            "paused": false
        }
    },
    "info": {
        "maxPlayers": 2,
        "buildables": {
            "Wall": {
                "title": "Wall",
                "cost": 200
            },
            "WatchTower": {
                "title": "Watch Tower",
                "cost": 1000
            }
        }
    },
    "players": {},
    "chat": {
        "messages": []
    },
    "buildables": {
        "SyZW5j6zCZ": {
            "id": "SyZW5j6zCZ",
            "name": "Castle",
            "owner": 1,
            "type": "Castle",
            "x": 288,
            "y": 2912,
            "health": 50,
            "max_health": 50,
            "width": 6,
            "height": 9,
            "built": true,
            "grace": [
                [8, 97],
                [15, 97],
                [8, 98],
                [15, 98],
                [9, 100],
                [8, 99],
                [10, 100],
                [11, 100],
                [12, 100],
                [13, 100],
                [14, 100],
                [15, 99]
            ],
            "restrict_grace": false,
            "operations": {
                "0": true
            }
        },
        "SJzWqjTMR-": {
            "id": "SJzWqjTMR-",
            "name": "Barracks",
            "owner": 1,
            "type": "Barracks",
            "x": 736,
            "y": 2880,
            "health": 35,
            "max_health": 35,
            "width": 7,
            "height": 7,
            "built": true,
            "grace": [
                [22, 95],
                [30, 95],
                [23, 97],
                [22, 96],
                [24, 97],
                [25, 97],
                [26, 97],
                [27, 97],
                [28, 97],
                [29, 97],
                [30, 96]
            ],
            "restrict_grace": true,
            "operations": {
                "0": true
            }
        },
        "HymW9i6G0W": {
            "id": "HymW9i6G0W",
            "name": "Castle",
            "owner": 2,
            "type": "Castle",
            "x": 3008,
            "y": 96,
            "health": 50,
            "max_health": 50,
            "width": 6,
            "height": 9,
            "built": true,
            "grace": [
                [93, 9],
                [100, 9],
                [93, 10],
                [100, 10],
                [94, 12],
                [93, 11],
                [95, 12],
                [96, 12],
                [97, 12],
                [98, 12],
                [99, 12],
                [100, 11]
            ],
            "restrict_grace": false,
            "operations": {
                "0": true
            }
        },
        "BkNbqopfRb": {
            "id": "BkNbqopfRb",
            "name": "Barracks",
            "owner": 2,
            "type": "Barracks",
            "x": 2880,
            "y": 736,
            "health": 35,
            "max_health": 35,
            "width": 7,
            "height": 7,
            "built": true,
            "grace": [
                [89, 28],
                [97, 28],
                [90, 30],
                [89, 29],
                [91, 30],
                [92, 30],
                [93, 30],
                [94, 30],
                [95, 30],
                [96, 30],
                [97, 29]
            ],
            "restrict_grace": true,
            "operations": {
                "0": true
            }
        }
    },
    "projectiles": {},
    "units": {},
    "items": {
        "Syr-qopzCW": {
            "id": "Syr-qopzCW",
            "name": "N/A",
            "owner": 0,
            "type": "Chest",
            "x": 2941,
            "y": 210,
            "open": false
        },
        "H1Lb9oaGR-": {
            "id": "H1Lb9oaGR-",
            "name": "N/A",
            "owner": 0,
            "type": "Chest",
            "x": 701,
            "y": 2290,
            "open": false
        }
    },
    "npc": {},
    "map": {
        "key": "Generic"
    }
};
container.set(data);

let data2 = clone(data);
data2.buildables["SyZW5j6zCZ"].x = 200;
data2.buildables["SyZW5j6zCZ"].y = 200;
data2.buildables["SJzWqjTMR-"].health = 2;
data2.buildables["BkNbqopfRb"].grace[0] = [20, 10];
container.set(data2);

let data3 = clone(data);
data3.items["Syr-qopzCW"].open = true;
data3.buildables["SJzWqjTMR-"].built = false;
data3.info.buildables["Wall"].cost = 100;
container.set(data3);
